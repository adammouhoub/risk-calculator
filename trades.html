<script>
    const STORAGE_KEY = 'forexTradeRecords';

    // *** REMOVED: window.onload = renderTrades; ***

    function saveTrades(trades) {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(trades));
    }

    function loadTrades() {
        const tradesJson = localStorage.getItem(STORAGE_KEY);
        // Ensure we return an array, even if storage is empty
        return tradesJson ? JSON.parse(tradesJson) : [];
    }

    function renderTrades() {
        const trades = loadTrades();
        const tradeBody = document.getElementById('tradeBody');
        tradeBody.innerHTML = ''; // Clear existing rows

        trades.forEach((trade, index) => {
            const row = tradeBody.insertRow();
            
            // Inserting cells and content
            row.insertCell().textContent = trade.date;
            row.insertCell().textContent = trade.pair;
            row.insertCell().textContent = trade.lot;
            row.insertCell().textContent = trade.entry;
            row.insertCell().textContent = trade.exit;
            row.insertCell().textContent = `$${parseFloat(trade.pl).toFixed(2)}`;
            row.insertCell().textContent = trade.rr;
            
            const statusCell = row.insertCell();
            statusCell.textContent = trade.status;
            statusCell.className = `status-${trade.status.toLowerCase()}`;

            const actionCell = row.insertCell();
            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = 'Delete';
            deleteBtn.className = 'delete-btn';
            deleteBtn.onclick = () => deleteTrade(index);
            actionCell.appendChild(deleteBtn);
        });
    }

    function addTrade() {
        const date = document.getElementById('tradeDate').value;
        const pair = document.getElementById('tradePair').value.toUpperCase();
        const lot = document.getElementById('tradeLot').value;
        const entry = document.getElementById('tradeEntry').value;
        const exit = document.getElementById('tradeExit').value;
        const pl = document.getElementById('tradePL').value;
        const rr = document.getElementById('tradeRR').value;
        const status = document.getElementById('tradeStatus').value;

        // Basic validation check
        if (!date || !pair || !lot || !entry || !exit || !pl || !rr) {
            alert('Please fill in all trade details.');
            return;
        }

        const newTrade = { date, pair, lot, entry, exit, pl, rr, status };
        
        const trades = loadTrades();
        trades.push(newTrade);
        saveTrades(trades);
        
        // Clear form fields
        document.getElementById('tradeDate').value = '';
        document.getElementById('tradePair').value = '';
        document.getElementById('tradeLot').value = '';
        document.getElementById('tradeEntry').value = '';
        document.getElementById('tradeExit').value = '';
        document.getElementById('tradePL').value = '';
        document.getElementById('tradeRR').value = '';

        // Crucial: Call renderTrades() to refresh the table after adding a new record
        renderTrades();
    }

    function deleteTrade(indexToDelete) {
        if (confirm('Are you sure you want to delete this trade record?')) {
            const trades = loadTrades();
            // Remove 1 element starting at the indexToDelete
            trades.splice(indexToDelete, 1); 
            saveTrades(trades);
            renderTrades();
        }
    }
    
    // Call renderTrades() directly at the end of the script to load data immediately.
    renderTrades(); 

</script>

